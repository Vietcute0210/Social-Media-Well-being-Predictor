<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Th·ªëng k√™ v√† ph√¢n t√≠ch xu h∆∞·ªõng s·ª©c kh·ªèe tinh th·∫ßn">
    <title>Th·ªëng k√™ - Social Media Well-being Predictor</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="../src/styles.css">`n    <link rel="stylesheet" href="../src/header-footer.css">
    
    <style>
        .dashboard-page {
            min-height: 100vh;
            padding-top: 80px;
            padding-bottom: 60px;
            background: #f5f7fa;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #F58529, #DD2A7B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 40px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(45deg, #F58529, #DD2A7B);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-trend {
            font-size: 0.85rem;
            color: #28a745;
        }

        .chart-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 1.5rem;
            margin-bottom: 25px;
            color: #333;
        }

        .persona-chart {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .chart-bar {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .bar-label {
            min-width: 150px;
            font-weight: 500;
            color: #333;
        }

        .bar-wrapper {
            flex: 1;
            background: #f1f3f5;
            border-radius: 20px;
            overflow: hidden;
            height: 30px;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(45deg, #F58529, #DD2A7B);
            border-radius: 20px;
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .activity-feed {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .activity-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background 0.2s ease;
        }

        .activity-item:hover {
            background: #f8f9fa;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            font-size: 1.5rem;
        }

        .activity-content {
            flex: 1;
        }

        .activity-time {
            font-size: 0.85rem;
            color: #999;
        }

        .activity-text {
            margin-top: 5px;
            color: #555;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            color: #666;
            margin-bottom: 10px;
        }

        .empty-state p {
            color: #999;
            margin-bottom: 30px;
        }

        .refresh-info {
            text-align: center;
            margin-top: 20px;
            color: #999;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .page-title {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .bar-label {
                min-width: 100px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div id="headerContainer"></div>

    <!-- Main Content -->
    <div class="dashboard-page">
        <div class="dashboard-container">
            <h1 class="page-title">üìà Th·ªëng k√™ & Ph√¢n t√≠ch</h1>
            <p class="page-subtitle">Xem xu h∆∞·ªõng v√† th·ªëng k√™ s·ª©c kh·ªèe tinh th·∫ßn c·ªßa b·∫°n</p>

            <div id="dashboardContent">
                <!-- Statistics Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-label">T·ªïng s·ªë l·∫ßn ph√¢n t√≠ch</div>
                        <div class="stat-value" id="totalPredictions">0</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üòä</div>
                        <div class="stat-label">H·∫°nh ph√∫c trung b√¨nh</div>
                        <div class="stat-value" id="avgHappiness">0</div>
                        <div class="stat-trend" id="happinessTrend"></div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üò∞</div>
                        <div class="stat-label">CƒÉng th·∫≥ng trung b√¨nh</div>
                        <div class="stat-value" id="avgStress">0</div>
                        <div class="stat-trend" id="stressTrend"></div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-label">Ph√¢n t√≠ch tu·∫ßn n√†y</div>
                        <div class="stat-value" id="recentCount">0</div>
                    </div>
                </div>

                <!-- Persona Distribution Chart -->
                <div class="chart-section">
                    <h2 class="chart-title">üìä Ph√¢n b·ªë Persona</h2>
                    <div class="persona-chart" id="personaChart">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Trend Chart (NEW) -->
                <div class="chart-section">
                    <h2 class="chart-title">üìâ Xu h∆∞·ªõng theo th·ªùi gian</h2>
                    <canvas id="trendChart" width="800" height="300" style="width: 100%; max-width: 800px;"></canvas>
                    <div class="chart-legend" style="display: flex; justify-content: center; gap: 30px; margin-top: 20px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 3px; background: #4CAF50;"></div>
                            <span style="font-size: 0.9rem; color: #666;">H·∫°nh ph√∫c</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 3px; background: #FF5252;"></div>
                            <span style="font-size: 0.9rem; color: #666;">CƒÉng th·∫≥ng</span>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="activity-feed">
                    <h2 class="chart-title">‚è±Ô∏è Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h2>
                    <div id="activityFeed">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <div class="refresh-info">
                    ‚ü≥ D·ªØ li·ªáu t·ª± ƒë·ªông c·∫≠p nh·∫≠t m·ªói 30 gi√¢y
                </div>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-icon">üìä</div>
                <h3>Ch∆∞a c√≥ d·ªØ li·ªáu th·ªëng k√™</h3>
                <p>H√£y th·ª±c hi·ªán ph√¢n t√≠ch ƒë·∫ßu ti√™n ƒë·ªÉ xem th·ªëng k√™!</p>
                <a href="../index.html" class="btn btn-primary" style="display: inline-block; padding: 12px 30px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; text-decoration: none; border-radius: 8px;">B·∫Øt ƒë·∫ßu ph√¢n t√≠ch</a>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div id="footerContainer"></div>

    <!-- Scripts -->
    <script src="../src/utils/storage.js"></script>
    <script src="../src/utils/stats.js"></script>
    <script src="../src/components/header.js"></script>
    <script src="../src/components/footer.js"></script>
    
    <script>
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            
            // Auto-refresh every 30 seconds
            setInterval(loadDashboard, 30000);
        });

        function loadDashboard() {
            const stats = getDashboardStats();
            
            // Check if we have data
            if (stats.total === 0) {
                showEmptyState();
                return;
            }
            
            hideEmptyState();
            updateStats(stats);
            updatePersonaChart(stats.personaDistribution);
            updateTrendChart();
            updateActivityFeed();
        }

        function drawTrendChart() {
            const canvas = document.getElementById('trendChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // Clear canvas
            ctx.clearRect(0, 0, width, height);
            
            // Get trend data
            const predictions = getAllPredictions().slice(0, 10).reverse(); // Last 10 predictions
            
            if (predictions.length === 0) {
                // Show empty message
                ctx.font = '16px Inter';
                ctx.fillStyle = '#999';
                ctx.textAlign = 'center';
                ctx.fillText('Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªß ƒë·ªÉ hi·ªÉn th·ªã bi·ªÉu ƒë·ªì', width / 2, height / 2);
                return;
            }
            
            // Setup
            const padding = 40;
            const chartWidth = width - (padding * 2);
            const chartHeight = height - (padding * 2);
            
            // Draw grid
            ctx.strokeStyle = '#eee';
            ctx.lineWidth = 1;
            
            // Horizontal lines (scores)
            for (let i = 0; i <= 10; i++) {
                const y = padding + (chartHeight - (i / 10 * chartHeight));
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
                
                // Labels
                ctx.fillStyle = '#999';
                ctx.font = '12px Inter';
                ctx.textAlign = 'right';
                ctx.fillText(i.toString(), padding - 10, y + 4);
            }
            
            // Extract data
            const happinessData = predictions.map(p => p.output.happiness_score);
            const stressData = predictions.map(p => p.output.stress_score);
            const step = chartWidth / Math.max(predictions.length - 1, 1);
            
            // Draw happiness line
            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            happinessData.forEach((score, i) => {
                const x = padding + (i * step);
                const y = padding + (chartHeight - (score / 10 * chartHeight));
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // Draw happiness dots
            ctx.fillStyle = '#4CAF50';
            happinessData.forEach((score, i) => {
                const x = padding + (i * step);
                const y = padding + (chartHeight - (score / 10 * chartHeight));
                
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw stress line
            ctx.strokeStyle = '#FF5252';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            stressData.forEach((score, i) => {
                const x = padding + (i * step);
                const y = padding + (chartHeight - (score / 10 * chartHeight));
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // Draw stress dots
            ctx.fillStyle = '#FF5252';
            stressData.forEach((score, i) => {
                const x = padding + (i * step);
                const y = padding + (chartHeight - (score / 10 * chartHeight));
                
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw x-axis labels (timestamps)
            ctx.fillStyle = '#999';
            ctx.font = '11px Inter';
            ctx.textAlign = 'center';
            
            predictions.forEach((p, i) => {
                if (i % Math.ceil(predictions.length / 5) === 0) {
                    const x = padding + (i * step);
                    const time = formatTimestamp(p.timestamp);
                    ctx.fillText(time.relative, x, height - 10);
                }
            });
        }

        function updateTrendChart() {
            drawTrendChart();
        }

        function showEmptyState() {
            document.getElementById('dashboardContent').style.display = 'none';
            document.getElementById('emptyState').style.display = 'block';
        }

        function hideEmptyState() {
            document.getElementById('dashboardContent').style.display = 'block';
            document.getElementById('emptyState').style.display = 'none';
        }

        function updateStats(stats) {
            // Total predictions
            document.getElementById('totalPredictions').textContent = stats.total;
            
            // Average scores
            document.getElementById('avgHappiness').textContent = stats.averageScores.happiness;
            document.getElementById('avgStress').textContent = stats.averageScores.stress;
            
            // Recent count
            document.getElementById('recentCount').textContent = stats.recentCount;
            
            // Trends
            const happinessTrend = stats.trends.happiness;
            const stressTrend = stats.trends.stress;
            
            const happinessTrendEl = document.getElementById('happinessTrend');
            const stressTrendEl = document.getElementById('stressTrend');
            
            if (happinessTrend.trend === 'up') {
                happinessTrendEl.textContent = `‚Üë +${happinessTrend.change} so v·ªõi tr∆∞·ªõc`;
                happinessTrendEl.style.color = '#28a745';
            } else if (happinessTrend.trend === 'down') {
                happinessTrendEl.textContent = `‚Üì ${happinessTrend.change} so v·ªõi tr∆∞·ªõc`;
                happinessTrendEl.style.color = '#dc3545';
            } else {
                happinessTrendEl.textContent = '‚Üí ·ªîn ƒë·ªãnh';
                happinessTrendEl.style.color = '#ffc107';
            }
            
            if (stressTrend.trend === 'up') {
                stressTrendEl.textContent = `‚Üë +${stressTrend.change} so v·ªõi tr∆∞·ªõc`;
                stressTrendEl.style.color = '#dc3545';
            } else if (stressTrend.trend === 'down') {
                stressTrendEl.textContent = `‚Üì ${stressTrend.change} so v·ªõi tr∆∞·ªõc`;
                stressTrendEl.style.color = '#28a745';
            } else {
                stressTrendEl.textContent = '‚Üí ·ªîn ƒë·ªãnh';
                stressTrendEl.style.color = '#ffc107';
            }
        }

        function updatePersonaChart(distribution) {
            const chartData = getPersonaChartData();
            const chartEl = document.getElementById('personaChart');
            
            if (chartData.length === 0) {
                chartEl.innerHTML = '<p style="text-align: center; color: #999;">Ch∆∞a c√≥ d·ªØ li·ªáu</p>';
                return;
            }
            
            // Find max for scaling
            const maxCount = Math.max(...chartData.map(d => d.count));
            
            chartEl.innerHTML = chartData.map(data => {
                const percentage = (data.count / maxCount * 100);
                
                return `
                    <div class="chart-bar">
                        <div class="bar-label">${data.label}</div>
                        <div class="bar-wrapper">
                            <div class="bar-fill" style="width: ${percentage}%">
                                ${data.count} (${data.percentage}%)
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateActivityFeed() {
            const recent = getRecentPredictions(5);
            const feedEl = document.getElementById('activityFeed');
            
            if (recent.length === 0) {
                feedEl.innerHTML = '<p style="text-align: center; color: #999;">Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o</p>';
                return;
            }
            
            feedEl.innerHTML = recent.map(p => {
                const time = formatTimestamp(p.timestamp);
                const icon = getPersonaIcon(p.output.persona);
                
                return `
                    <div class="activity-item">
                        <div class="activity-icon">${icon}</div>
                        <div class="activity-content">
                            <div class="activity-time">${time.relative}</div>
                            <div class="activity-text">
                                <strong>${p.output.persona}</strong> - 
                                H·∫°nh ph√∫c: ${p.output.happiness_score} | 
                                CƒÉng th·∫≥ng: ${p.output.stress_score}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getPersonaIcon(persona) {
            const icons = {
                'Power User': '‚ö°',
                'Light User': 'üåô',
                'Influencer': '‚≠ê',
                'Ghost User': 'üëª',
                'Social Butterfly': 'ü¶ã'
            };
            return icons[persona] || 'üë§';
        }
    </script>
</body>
</html>
